{
  "InstanceIds": ["i-0fba58db502cc8d39"],
  "DocumentName": "AWS-RunShellScript",
  "Parameters": {
    "commands": [
      "cd /var/www/summit/server",
      "echo '=== PM2 Status ==='",
      "pm2 list",
      "echo ''",
      "echo '=== Backend Process ==='",
      "ps aux | grep 'node.*dist/index.js' | grep -v grep || echo 'Backend process not running'",
      "echo ''",
      "echo '=== Port 3000 ==='",
      "lsof -i:3000 || echo 'Port 3000 is free'",
      "echo ''",
      "echo '=== Recent PM2 Logs (last 20 lines) ==='",
      "pm2 logs summit-backend --lines 20 --nostream 2>&1 | tail -20",
      "echo ''",
      "echo '=== Environment Variables ==='",
      "cat .env | grep -E '^(PORT|SUPABASE|CORS)' || echo 'No env vars found'",
      "echo ''",
      "echo '=== Testing local health ==='",
      "curl -s http://localhost:3000/health || echo 'Local health check failed'"
    ]
  }
}

