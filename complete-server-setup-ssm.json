{
  "commands": [
    "echo '=== Complete Server Setup ==='",
    "echo ''",
    "echo 'Step 1: Check if directory exists'",
    "cd /var/www/summit/server 2>&1 && echo 'Directory exists' || echo 'ERROR: Directory does not exist'",
    "pwd",
    "echo ''",
    "echo 'Step 2: Check if package.json exists'",
    "test -f package.json && echo 'package.json exists' || echo 'ERROR: package.json not found'",
    "echo ''",
    "echo 'Step 3: Install dependencies'",
    "npm install 2>&1 | tail -3",
    "echo ''",
    "echo 'Step 4: Build the code'",
    "npm run build 2>&1 | tail -5",
    "echo ''",
    "echo 'Step 5: Check if dist/index.js exists'",
    "test -f dist/index.js && echo 'dist/index.js EXISTS' || echo 'ERROR: dist/index.js NOT FOUND'",
    "echo ''",
    "echo 'Step 6: Create .env file'",
    "cat > .env << 'EOF'",
    "PORT=3000",
    "DB_HOST=codingeverest-new.cl4qcomc6fj0.eu-west-1.rds.amazonaws.com",
    "DB_PORT=5432",
    "DB_NAME=Summit",
    "DB_USER=postgres",
    "DB_PASSWORD=Stacey1122",
    "SUMMIT_DB_HOST=summit-db.cl4qcomc6fj0.eu-west-1.rds.amazonaws.com",
    "SUMMIT_DB_PORT=5432",
    "SUMMIT_DB_NAME=Summit",
    "SUMMIT_DB_USER=postgres",
    "SUMMIT_DB_PASSWORD=Stacey1122",
    "JWT_SECRET=summit-jwt-secret",
    "SUMMIT_API_KEY=summit-api-key",
    "CORS_ORIGIN=http://localhost:5173,https://www.codingeverest.com,https://codingeverest.com,https://summit.codingeverest.com",
    "EOF",
    "echo '.env file created'",
    "echo ''",
    "echo 'Step 7: Stop old process'",
    "pm2 stop summit 2>/dev/null; pm2 delete summit 2>/dev/null; true",
    "echo ''",
    "echo 'Step 8: Start server'",
    "export HOME=/root",
    "cd /var/www/summit/server",
    "PORT=3000 pm2 start dist/index.js --name summit",
    "pm2 save",
    "sleep 5",
    "echo ''",
    "echo 'Step 9: Check status'",
    "pm2 list",
    "echo ''",
    "echo 'Step 10: Test health'",
    "curl -s http://localhost:3000/health || echo 'HEALTH_CHECK_FAILED'"
  ]
}

