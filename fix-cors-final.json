{
  "commands": [
    "sudo cat > /etc/nginx/conf.d/summit-api.conf << 'NGINXEOF'",
    "server {",
    "    listen 80;",
    "    listen [::]:80;",
    "    server_name summit-api.codingeverest.com;",
    "    return 301 https://$host$request_uri;",
    "}",
    "server {",
    "    listen 443 ssl;",
    "    listen [::]:443 ssl;",
    "    http2 on;",
    "    server_name summit-api.codingeverest.com;",
    "    ssl_certificate /etc/letsencrypt/live/summit-api.codingeverest.com/fullchain.pem;",
    "    ssl_certificate_key /etc/letsencrypt/live/summit-api.codingeverest.com/privkey.pem;",
    "    ssl_protocols TLSv1.2 TLSv1.3;",
    "    ssl_ciphers HIGH:!aNULL:!MD5;",
    "    ssl_prefer_server_ciphers on;",
    "    access_log /var/log/nginx/summit-api-access.log;",
    "    error_log /var/log/nginx/summit-api-error.log;",
    "    location /api {",
    "        proxy_pass http://127.0.0.1:4000/api;",
    "        proxy_http_version 1.1;",
    "        proxy_set_header Host $host;",
    "        proxy_set_header X-Real-IP $remote_addr;",
    "        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;",
    "        proxy_set_header X-Forwarded-Proto $scheme;",
    "        proxy_connect_timeout 60s;",
    "        proxy_send_timeout 60s;",
    "        proxy_read_timeout 60s;",
    "    }",
    "    location /health {",
    "        proxy_pass http://127.0.0.1:4000/health;",
    "        access_log off;",
    "    }",
    "}",
    "NGINXEOF",
    "sudo nginx -t",
    "sudo systemctl reload nginx",
    "echo 'âœ… Nginx config updated - CORS handled by backend only'"
  ]
}

