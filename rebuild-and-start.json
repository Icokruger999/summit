{
  "InstanceIds": ["i-0fba58db502cc8d39"],
  "DocumentName": "AWS-RunShellScript",
  "Parameters": {
    "commands": [
      "cd /var/www/summit/server",
      "echo 'Pulling latest code...'",
      "git pull origin main",
      "echo 'Rebuilding with fixed code...'",
      "npm run build",
      "echo 'Stopping old process...'",
      "pm2 delete summit-backend 2>/dev/null || true",
      "sleep 2",
      "echo 'Starting with new build...'",
      "pm2 start dist/index.js --name summit-backend --update-env",
      "sleep 5",
      "pm2 list",
      "echo ''",
      "curl -s http://localhost:3000/health && echo ' - HEALTH OK!' || echo ' - HEALTH FAILED'"
    ]
  }
}

