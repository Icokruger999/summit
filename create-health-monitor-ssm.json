{
  "commands": [
    "echo '=== Creating Health Check Script ==='",
    "cat > /usr/local/bin/check-summit-health.sh << 'EOFSCRIPT'",
    "#!/bin/bash",
    "HEALTH_URL=\"http://localhost:3000/health\"",
    "RESPONSE=$(curl -s -o /dev/null -w \"%{http_code}\" $HEALTH_URL 2>/dev/null)",
    "if [ \"$RESPONSE\" != \"200\" ]; then",
    "  echo \"$(date): Health check failed (HTTP $RESPONSE). Restarting server...\"",
    "  export HOME=/root",
    "  cd /var/www/summit/server",
    "  pm2 restart summit",
    "  sleep 5",
    "  pm2 save",
    "fi",
    "EOFSCRIPT",
    "chmod +x /usr/local/bin/check-summit-health.sh",
    "echo 'Health check script created'",
    "echo ''",
    "echo 'Creating systemd timer for health checks (every 5 minutes):'",
    "cat > /etc/systemd/system/summit-health-check.service << 'EOFSERVICE'",
    "[Unit]",
    "Description=Summit Health Check and Auto-Restart",
    "",
    "[Service]",
    "Type=oneshot",
    "ExecStart=/usr/local/bin/check-summit-health.sh",
    "EOFSERVICE",
    "cat > /etc/systemd/system/summit-health-check.timer << 'EOFTIMER'",
    "[Unit]",
    "Description=Summit Health Check Timer",
    "",
    "[Timer]",
    "OnBootSec=5min",
    "OnUnitActiveSec=5min",
    "",
    "[Install]",
    "WantedBy=timers.target",
    "EOFTIMER",
    "systemctl daemon-reload",
    "systemctl enable summit-health-check.timer",
    "systemctl start summit-health-check.timer",
    "systemctl status summit-health-check.timer --no-pager | head -10",
    "echo ''",
    "echo 'âœ… Health check monitor installed and enabled'"
  ]
}

