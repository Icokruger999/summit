{
  "commands": [
    "cd /var/www/summit/server",
    "echo '=== Step 1: Check if code exists ==='",
    "pwd && ls -la | head -10",
    "echo ''",
    "echo '=== Step 2: Install dependencies (if needed) ==='",
    "npm install 2>&1 | tail -5",
    "echo ''",
    "echo '=== Step 3: Build the code ==='",
    "npm run build 2>&1 | tail -10",
    "echo ''",
    "echo '=== Step 4: Check if dist/index.js exists ==='",
    "ls -la dist/index.js || echo 'ERROR: dist/index.js not found!'",
    "echo ''",
    "echo '=== Step 5: Ensure .env has PORT=3000 ==='",
    "echo 'PORT=3000' > .env.tmp && cat .env 2>/dev/null | grep -v '^PORT=' >> .env.tmp && mv .env.tmp .env || echo 'PORT=3000' > .env",
    "echo 'DB_HOST=codingeverest-new.cl4qcomc6fj0.eu-west-1.rds.amazonaws.com' >> .env",
    "echo 'DB_PORT=5432' >> .env",
    "echo 'DB_NAME=Summit' >> .env",
    "echo 'DB_USER=postgres' >> .env",
    "echo 'DB_PASSWORD=Stacey1122' >> .env",
    "echo 'SUMMIT_DB_HOST=summit-db.cl4qcomc6fj0.eu-west-1.rds.amazonaws.com' >> .env",
    "echo 'SUMMIT_DB_PORT=5432' >> .env",
    "echo 'SUMMIT_DB_NAME=Summit' >> .env",
    "echo 'SUMMIT_DB_USER=postgres' >> .env",
    "echo 'SUMMIT_DB_PASSWORD=Stacey1122' >> .env",
    "echo 'JWT_SECRET=summit-jwt-secret' >> .env",
    "cat .env | head -5",
    "echo ''",
    "echo '=== Step 6: Stop and delete old PM2 process ==='",
    "pm2 stop summit 2>/dev/null; pm2 delete summit 2>/dev/null; true",
    "echo ''",
    "echo '=== Step 7: Start server with PM2 ==='",
    "PORT=3000 pm2 start dist/index.js --name summit",
    "pm2 save",
    "sleep 5",
    "echo ''",
    "echo '=== Step 8: Check PM2 status ==='",
    "pm2 list",
    "echo ''",
    "echo '=== Step 9: Test health endpoint ==='",
    "sleep 2",
    "curl -s http://localhost:3000/health || echo 'Health check FAILED'",
    "echo ''",
    "echo '=== Step 10: Check port ==='",
    "ss -tlnp | grep :3000 || echo 'Port 3000 NOT listening'"
  ]
}

