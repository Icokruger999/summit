{
  "commands": [
    "echo '=== Deploying Nginx Configuration for WebSocket Support ==='",
    "echo '---'",
    "echo 'Step 1: Backing up existing nginx config...'",
    "if [ -f /etc/nginx/sites-available/summit-api ]; then BACKUP_FILE=/etc/nginx/sites-available/summit-api.backup.$(date +%Y%m%d_%H%M%S); sudo cp /etc/nginx/sites-available/summit-api \"$BACKUP_FILE\"; echo \"Backed up to: $BACKUP_FILE\"; else echo 'No existing config found, will create new one'; fi",
    "echo '---'",
    "echo 'Step 2: Pulling latest from GitHub...'",
    "cd /var/www/summit",
    "git pull origin main",
    "echo '---'",
    "echo 'Step 3: Verifying nginx config file exists in repo...'",
    "if [ ! -f summit-api-nginx.conf ]; then echo 'ERROR: summit-api-nginx.conf NOT found in repository!'; exit 1; fi",
    "echo 'Config file found in repository'",
    "echo '---'",
    "echo 'Step 4: Copying nginx config to server...'",
    "sudo cp summit-api-nginx.conf /etc/nginx/sites-available/summit-api",
    "echo 'Config copied to /etc/nginx/sites-available/summit-api'",
    "echo '---'",
    "echo 'Step 5: Testing nginx configuration syntax...'",
    "sudo nginx -t",
    "if [ $? -eq 0 ]; then echo 'Nginx config syntax is valid'; echo '---'; echo 'Step 6: Reloading nginx...'; sudo systemctl reload nginx; echo 'Nginx reloaded successfully'; echo '---'; echo 'Step 7: Verifying WebSocket location exists...'; grep -A 2 'location /ws' /etc/nginx/sites-available/summit-api && echo 'WebSocket location found' || echo 'WebSocket location NOT found'; echo '---'; echo 'Nginx WebSocket configuration deployed successfully!'; else echo 'Nginx config test failed - NOT reloading'; exit 1; fi"
  ]
}
